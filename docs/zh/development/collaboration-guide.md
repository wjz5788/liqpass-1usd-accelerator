# 协作流程与规范

## 文档信息
- **版本**: 1.0.0
- **最后更新**: 2024-01-23
- **作者**: LiqPass 开发团队

## 摘要
本手册提供了 LiqPass 项目的协作流程和规范，包括团队协作、项目管理、代码审查和 CI/CD 等方面，旨在确保团队高效协作，保证项目质量。

## 1. 团队协作

### 1.1 角色与职责

| 角色 | 职责 |
|-----|-----|
| 项目经理 | 负责项目规划、进度跟踪、资源协调和风险管理 |
| 架构师 | 负责系统架构设计、技术选型和架构优化 |
| 前端开发工程师 | 负责前端应用开发、测试和维护 |
| 后端开发工程师 | 负责后端服务开发、测试和维护 |
| 智能合约工程师 | 负责智能合约开发、测试和部署 |
| 测试工程师 | 负责测试计划制定、测试用例编写和测试执行 |
| 运维工程师 | 负责系统部署、监控和维护 |
| 文档工程师 | 负责文档编写、维护和更新 |

### 1.2 沟通机制

#### 1.2.1 会议
- **每日站会**：15分钟，同步进度和遇到的问题
- **周会**：每周一次，总结上周工作，规划下周工作
- **技术评审会**：需求变更或技术方案评审时召开
- ** Sprint 计划会**：每个 Sprint 开始时召开，确定 Sprint 目标和任务
- ** Sprint 回顾会**：每个 Sprint 结束时召开，总结经验教训

#### 1.2.2 沟通工具
- **即时通讯**：微信/企业微信/Slack
- **项目管理**：GitHub Projects
- **代码仓库**：GitHub
- **文档协作**：GitHub Wiki/文档系统
- **视频会议**：Zoom/腾讯会议

### 1.3 协作原则

1. **透明沟通**：保持信息透明，及时共享进展和问题
2. **责任明确**：每个任务都有明确的负责人
3. **尊重他人**：尊重团队成员的意见和工作
4. **持续学习**：不断学习和分享新技术
5. **质量第一**：确保代码和文档质量

## 2. 项目管理

### 2.1 开发模式

采用 **Scrum** 敏捷开发模式，每个 Sprint 周期为 2 周。

### 2.2 任务管理

#### 2.2.1 任务类型
- **功能需求**：新功能开发
- **缺陷修复**：修复生产或测试环境中的缺陷
- **技术债务**：重构、优化等技术改进
- **改进建议**：流程或工具改进

#### 2.2.2 任务状态
- **待办**：任务已创建，等待分配
- **进行中**：任务已分配，正在开发
- **待审查**：开发完成，等待代码审查
- **已审查**：代码审查通过，等待测试
- **待测试**：代码已合并，等待测试
- **已测试**：测试通过，等待发布
- **已完成**：任务已完成

#### 2.2.3 任务优先级
- **高**：核心功能、紧急缺陷
- **中**：一般功能、普通缺陷
- **低**：改进建议、技术债务

### 2.3 版本管理

#### 2.3.1 版本号格式
- 采用语义化版本号：`主版本号.次版本号.修订号`
- 主版本号：重大变更，不兼容的 API 更改
- 次版本号：新增功能，向下兼容
- 修订号：修复缺陷，向下兼容

#### 2.3.2 发布流程
1. 确定发布内容和版本号
2. 创建发布分支 `release/vx.y.z`
3. 进行回归测试
4. 修复测试中发现的问题
5. 合并到 `main` 分支
6. 打标签 `vx.y.z`
7. 部署到生产环境
8. 发布版本说明

## 3. Git 工作流

### 3.1 分支策略

#### 3.1.1 主要分支
- **main**：主分支，用于发布稳定版本
  - 只允许从 `release` 或 `hotfix` 分支合并
  - 每次合并后打标签
- **develop**：开发分支，用于集成各功能分支
  - 从 `main` 分支创建
  - 允许从 `feature` 或 `bugfix` 分支合并

#### 3.1.2 辅助分支
- **feature/xxx**：功能分支，用于开发新功能
  - 从 `develop` 分支创建
  - 命名格式：`feature/功能名称`
  - 开发完成后合并到 `develop` 分支
- **bugfix/xxx**：bug 修复分支，用于修复测试环境中的缺陷
  - 从 `develop` 分支创建
  - 命名格式：`bugfix/缺陷描述`
  - 修复完成后合并到 `develop` 分支
- **hotfix/xxx**：热修复分支，用于紧急修复生产环境中的缺陷
  - 从 `main` 分支创建
  - 命名格式：`hotfix/缺陷描述`
  - 修复完成后合并到 `main` 和 `develop` 分支
- **release/xxx**：发布分支，用于准备发布新版本
  - 从 `develop` 分支创建
  - 命名格式：`release/vx.y.z`
  - 只允许修复缺陷，不允许添加新功能
  - 发布完成后合并到 `main` 和 `develop` 分支

### 3.2 代码提交规范

采用 **Conventional Commits** 规范，提交信息格式：

```
type(scope?): description

[optional body]

[optional footer(s)]
```

#### 3.2.1 type 类型
- **feat**：新功能
- **fix**：修复缺陷
- **docs**：文档更新
- **style**：代码格式调整，不影响功能
- **refactor**：代码重构，不添加新功能或修复缺陷
- **test**：测试相关
- **chore**：构建过程或辅助工具的变动

#### 3.2.2 scope（可选）
- 指定影响的模块或组件
- 示例：`feat(insurance): add quote functionality`

#### 3.2.3 description
- 简明描述提交内容
- 使用祈使句，首字母小写，结尾不加句号

#### 3.2.4 body（可选）
- 详细描述提交内容
- 可以使用多行

#### 3.2.5 footer（可选）
- 关联 Issue：`Closes #123` 或 `Fixes #123`
- 破坏性变更：`BREAKING CHANGE: ...`

#### 3.2.6 示例

```
feat(insurance): add quote functionality

Add GET /api/v1/insurance/quote endpoint to generate insurance quotes

Closes #456
```

### 3.3 代码审查流程

1. **创建 Pull Request**：开发完成后，从功能分支向目标分支创建 Pull Request
2. **添加审查者**：添加至少 2 名相关领域的开发者作为审查者
3. **代码审查**：审查者对代码进行审查，提出意见和建议
4. **修改代码**：开发者根据审查意见修改代码
5. **再次审查**：审查者确认修改是否符合要求
6. **合并代码**：审查通过后，合并代码到目标分支
7. **删除分支**：合并完成后，删除功能分支

#### 3.3.1 代码审查要点
- **代码质量**：代码可读性、可维护性
- **功能正确性**：实现是否符合需求
- **性能**：是否存在性能问题
- **安全性**：是否存在安全漏洞
- **测试覆盖率**：是否有足够的测试用例
- **遵循规范**：是否遵循代码规范和最佳实践

#### 3.3.2 审查反馈规范
- **具体明确**：指出具体的问题和位置
- **建设性**：提供改进建议，而不仅仅是指出问题
- **尊重他人**：使用礼貌的语言
- **及时反馈**：在 24 小时内给出反馈

## 4. CI/CD 流程

### 4.1 持续集成

#### 4.1.1 触发条件
- 代码推送到远程仓库
- Pull Request 创建或更新

#### 4.1.2 执行步骤
1. **代码检查**：ESLint、Prettier、TypeScript 编译
2. **单元测试**：运行单元测试
3. **集成测试**：运行集成测试
4. **构建**：构建项目
5. **生成报告**：测试覆盖率报告、构建报告

#### 4.1.3 失败处理
- CI 失败时，通知相关开发者
- 开发者需要及时修复问题，确保 CI 通过

### 4.2 持续部署

#### 4.2.1 环境
- **开发环境**：用于开发和测试
- **测试环境**：用于集成测试和验收测试
- **预生产环境**：用于最终验证
- **生产环境**：正式上线环境

#### 4.2.2 部署策略

| 环境 | 触发条件 | 部署方式 |
|-----|---------|---------|
| 开发环境 | 合并到 `develop` 分支 | 自动部署 |
| 测试环境 | 合并到 `release` 分支 | 自动部署 |
| 预生产环境 | 创建 `release` 分支 | 手动触发 |
| 生产环境 | 合并到 `main` 分支 | 手动触发，需要审批 |

#### 4.2.3 部署流程
1. **构建镜像**：构建 Docker 镜像
2. **推送镜像**：将镜像推送到镜像仓库
3. **部署应用**：使用 Kubernetes 或其他工具部署应用
4. **健康检查**：检查应用是否正常运行
5. **通知**：部署完成后通知相关人员

### 4.3 监控与告警

#### 4.3.1 监控指标
- **系统指标**：CPU、内存、磁盘、网络
- **应用指标**：响应时间、请求量、错误率
- **业务指标**：用户数、交易量、转化率

#### 4.3.2 告警机制
- 设置合理的告警阈值
- 告警方式：邮件、短信、即时通讯
- 告警分级：严重、警告、信息
- 告警处理：明确的告警处理流程和责任人

## 5. 文档管理

### 5.1 文档类型

- **需求文档**：描述项目需求和功能
- **设计文档**：描述系统设计和架构
- **开发文档**：开发手册、API 文档
- **测试文档**：测试计划、测试用例、测试报告
- **部署文档**：部署流程、配置说明
- **用户文档**：用户手册、操作指南

### 5.2 文档编写规范

- 使用 Markdown 格式
- 遵循统一的文档模板
- 保持文档更新及时
- 使用清晰、准确的语言
- 包含必要的图表和示例

### 5.3 文档审核流程

1. **编写文档**：文档工程师或开发人员编写文档
2. **提交审核**：提交文档进行审核
3. **文档审核**：相关领域的专家审核文档
4. **修改文档**：根据审核意见修改文档
5. **发布文档**：审核通过后，发布文档

## 6. 质量保障

### 6.1 代码质量

#### 6.1.1 代码规范
- 前端：ESLint、Prettier、TypeScript 规范
- 后端：ESLint、Prettier、TypeScript 规范
- 智能合约：Solidity 规范

#### 6.1.2 静态代码分析
- 前端：ESLint、TypeScript 编译
- 后端：ESLint、TypeScript 编译
- 智能合约：Slither、MythX

#### 6.1.3 测试覆盖率
- 核心功能：≥ 80%
- 普通功能：≥ 60%
- 辅助功能：≥ 40%

### 6.2 测试流程

1. **测试计划**：测试工程师制定测试计划
2. **测试用例**：测试工程师编写测试用例
3. **测试执行**：测试工程师执行测试
4. **缺陷管理**：记录和跟踪缺陷
5. **测试报告**：生成测试报告

#### 6.2.1 测试类型

- **单元测试**：测试单个组件或函数
- **集成测试**：测试组件间的交互
- **API 测试**：测试 API 接口
- **E2E 测试**：测试完整的用户流程
- **性能测试**：测试系统性能
- **安全测试**：测试系统安全性

### 6.3 缺陷管理

#### 6.3.1 缺陷等级

| 等级 | 描述 |
|-----|-----|
| 严重 | 系统崩溃、数据丢失、严重安全漏洞 |
| 高 | 功能无法使用、影响主要流程 |
| 中 | 功能部分可用、影响次要流程 |
| 低 | 界面问题、轻微功能缺陷 |

#### 6.3.2 缺陷处理流程

1. **缺陷报告**：测试工程师或用户报告缺陷
2. **缺陷确认**：开发工程师确认缺陷
3. **缺陷修复**：开发工程师修复缺陷
4. **缺陷验证**：测试工程师验证缺陷是否修复
5. **缺陷关闭**：缺陷修复后关闭

## 7. 安全管理

### 7.1 安全原则

- **最小权限**：只授予必要的权限
- ** defence in depth**：多层安全防御
- **安全左移**：将安全融入开发流程的各个阶段
- **定期审计**：定期进行安全审计和渗透测试

### 7.2 安全实践

#### 7.2.1 代码安全
- 遵循安全编码规范
- 使用安全的依赖库
- 定期更新依赖库
- 进行安全代码审查

#### 7.2.2 基础设施安全
- 配置安全组和防火墙
- 使用加密传输（HTTPS/TLS）
- 定期备份数据
- 实现灾备方案

#### 7.2.3 访问控制
- 实现强密码策略
- 使用多因素认证
- 定期审查和更新访问权限
- 实现单点登录（SSO）

### 7.3 安全事件响应

1. **事件检测**：检测安全事件
2. **事件报告**：报告安全事件
3. **事件分析**：分析事件原因和影响
4. **事件响应**：采取措施控制和缓解事件
5. **事件恢复**：恢复系统正常运行
6. **事件总结**：总结经验教训，改进安全措施

## 8. 最佳实践

1. **自动化**：尽可能自动化重复的任务，如构建、测试、部署
2. **持续改进**：不断改进流程和规范
3. **知识共享**：定期分享知识和经验
4. **关注质量**：质量优先，不要牺牲质量换取速度
5. **用户中心**：始终关注用户需求和体验
6. **拥抱变化**：适应需求和技术的变化

## 9. 工具链

| 类别 | 工具 |
|-----|-----|
| 代码仓库 | GitHub |
| 项目管理 | GitHub Projects |
| 即时通讯 | 微信/企业微信/Slack |
| 视频会议 | Zoom/腾讯会议 |
| CI/CD | GitHub Actions |
| 容器化 | Docker |
| 编排 | Kubernetes |
| 监控 | Prometheus + Grafana |
| 日志管理 | ELK Stack |
| 文档 | GitHub Wiki/文档系统 |

## 更新日志
| 日期 | 版本 | 更新内容 | 作者 |
|------|------|----------|------|
| 2024-01-23 | 1.0.0 | 初始版本 | LiqPass 开发团队 |