# LiqPass 1USD Accelerator - Overall Architecture Design (Arena / Insurance / Stocks / Accelerator)

> Scope: Read-only architecture documentation for splitting the repo into 4 domain modules: `arena` / `insurance` / `stocks` / `accelerator`.
>
> Hard constraints (this round): no code changes, no installs, no lint/format-fix, no PR. Evidence must point to repo paths.

---

## A. 现状盘点

### A1) 技术栈与入口

- Frontend stack
  - Vite + React 18 + TypeScript
    - Evidence: `package.json`, `vite.config.ts`
  - Routing: React Router v6
    - Evidence: `package.json`, `src/App.tsx`
  - State: Zustand
    - Evidence: `package.json`, `src/store/uiStore.ts`, `src/store/userStore.ts`, `src/store/projectsStore.ts`
  - Styling: TailwindCSS + postcss/autoprefixer
    - Evidence: `package.json`
  - Testing: Vitest + Testing Library
    - Evidence: `package.json`, `vite.config.ts`

- Entrypoints: multi-entry (2 HTML inputs)
  - Main app: `index.html` -> `src/main.tsx` -> `src/App.tsx`
    - Evidence: `index.html`, `src/main.tsx`, `src/App.tsx`
  - Meme board standalone: `meme-board.html` -> `src/meme-board-main.tsx` -> `src/pages/accelerator/MemeBoardPage.tsx`
    - Evidence: `meme-board.html`, `src/meme-board-main.tsx`, `src/pages/accelerator/MemeBoardPage.tsx`
  - Build config confirms multi-entry
    - Evidence: `vite.config.ts` (rollupOptions.input.main + input['meme-board'])

- Routing structure
  - Route table centralized in `src/App.tsx` (lazy pages + Suspense + Layout + ErrorBoundary)
    - Evidence: `src/App.tsx`, `src/components/Layout.tsx`, `src/components/common/ErrorBoundary.tsx`
  - A separate route list doc exists (but it is not the source of truth)
    - Evidence: `docs/04-路由配置.md`

- Notable architectural smell (for later fix)
  - Standalone entry `src/meme-board-main.tsx` renders a page directly and bypasses App Shell responsibilities (ErrorBoundary/Layout/route guards/analytics)
    - Evidence: `src/meme-board-main.tsx`, `src/App.tsx`

### A2) 模块/页面清单（按四域归类）

Source-of-truth routes are in `src/App.tsx` (and cross-checked with `docs/04-路由配置.md`).

| URL Path                        | Page Component                                   | Domain                 | Rationale                                          | Evidence                                                                                                       |
| ------------------------------- | ------------------------------------------------ | ---------------------- | -------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `/`                             | `src/pages/HomePage.tsx`                         | (Shell / cross-domain) | Landing page linking into 3 domains                | `src/pages/HomePage.tsx`                                                                                       |
| `/arena`                        | `src/pages/ArenaPage.tsx`                        | arena                  | Competition/tournament + signup + rules            | `src/pages/ArenaPage.tsx`, `src/App.tsx`                                                                       |
| `/strategies`                   | `src/pages/StrategiesPage.tsx`                   | stocks                 | Asset selection + leverage + "资金盘" + NFT shares | `src/pages/StrategiesPage.tsx`, `src/App.tsx`                                                                  |
| `/strategies/simulator`         | `src/pages/StrategySimulatorPage.tsx`            | stocks                 | Strategy profit distribution simulator             | `src/pages/StrategySimulatorPage.tsx`, `src/App.tsx`                                                           |
| `/insurance`                    | `src/pages/InsurancePage.tsx`                    | insurance              | Insurance purchase flow + policies + claims        | `src/pages/InsurancePage.tsx`, `src/App.tsx`                                                                   |
| `/reward-hall`                  | `src/pages/RewardHallPage.tsx`                   | accelerator            | Reward hall: loot pool + prediction pool + winners | `src/pages/RewardHallPage.tsx`, `src/App.tsx`                                                                  |
| `/accelerator`                  | `src/pages/accelerator/AcceleratorHomePage.tsx`  | accelerator            | Accelerator landing / discovery UI                 | `src/pages/accelerator/AcceleratorHomePage.tsx`, `src/App.tsx`                                                 |
| `/accelerator/projects`         | `src/pages/accelerator/ProjectsPage.tsx`         | accelerator            | Projects list + support entry                      | `src/pages/accelerator/ProjectsPage.tsx`, `src/App.tsx`                                                        |
| `/accelerator/projects/:id`     | `src/pages/accelerator/ProjectDetailPage.tsx`    | accelerator            | Project detail + support                           | `src/pages/accelerator/ProjectDetailPage.tsx`, `src/App.tsx`                                                   |
| `/accelerator/submit`           | `src/pages/accelerator/SubmitProjectPage.tsx`    | accelerator            | Project submission form (cover + videos)           | `src/pages/accelerator/SubmitProjectPage.tsx`, `src/App.tsx`                                                   |
| `/accelerator/shorts`           | `src/pages/accelerator/ShortsWallPage.tsx`       | accelerator            | Short video wall for projects                      | `src/pages/accelerator/ShortsWallPage.tsx`, `src/App.tsx`                                                      |
| `/accelerator/lottery`          | `src/pages/accelerator/LotteryPage.tsx`          | accelerator            | Lottery rounds + buy tickets                       | `src/pages/accelerator/LotteryPage.tsx`, `src/App.tsx`                                                         |
| `/accelerator/tickets`          | `src/pages/accelerator/MyTicketsPage.tsx`        | accelerator            | My positions/tickets                               | `src/pages/accelerator/MyTicketsPage.tsx`, `src/App.tsx`                                                       |
| `/accelerator/markets`          | `src/pages/accelerator/MarketsPage.tsx`          | accelerator            | Prediction markets / betting                       | `src/pages/accelerator/MarketsPage.tsx`, `src/App.tsx`                                                         |
| `/accelerator/transparency`     | `src/pages/accelerator/TransparencyPage.tsx`     | accelerator            | Transparency report: pools/tx/contracts            | `src/pages/accelerator/TransparencyPage.tsx`, `src/App.tsx`                                                    |
| `/accelerator/heat-rank`        | `src/pages/accelerator/HeatRankPage.tsx`         | accelerator            | Discovery ranking based on "heat"                  | `src/pages/accelerator/HeatRankPage.tsx`, `src/App.tsx`                                                        |
| `/accelerator/meme-board`       | `src/pages/accelerator/MemeBoardPage.tsx`        | accelerator            | Meme board (also has standalone entry)             | `src/pages/accelerator/MemeBoardPage.tsx`, `src/meme-board-main.tsx`                                           |
| `/accelerator/meme-project/:id` | `src/pages/accelerator/OneDollarProjectPage.tsx` | accelerator            | Pump-like project page + event markets             | `src/pages/accelerator/OneDollarProjectPage.tsx`, `src/App.tsx`                                                |
| `/accelerator/dashboard`        | `src/pages/AcceleratorDashboardPage.tsx`         | accelerator            | Dashboard-style ticker/projects/winners            | `src/pages/AcceleratorDashboardPage.tsx`, `src/App.tsx`                                                        |
| `/accelerator/admin`            | `src/pages/accelerator/AdminProjectsPage.tsx`    | accelerator            | Admin panel for project review                     | `src/pages/accelerator/AdminProjectsPage.tsx`, `src/App.tsx`                                                   |
| `/accelerator/lottery-board`    | `src/pages/accelerator/cz.tsx`                   | accelerator            | Lottery project board UI                           | `src/pages/accelerator/cz.tsx`, `src/App.tsx`                                                                  |
| `/p/:id`                        | `src/pages/project/ProjectPage.tsx`              | stocks                 | Project research/index basket/evidence feed        | `src/pages/project/ProjectPage.tsx`, `src/components/features/ProjectPage/IndexBasketPanel.tsx`, `src/App.tsx` |

Note: `/` is a cross-domain landing. If you require strict 4-domain-only classification, treat it as part of `accelerator` "入口/导流" (product decision), but architecture-wise it behaves like shell.

### A3) 关键共享（跨域复用的组件/工具）

- App Shell-ish components
  - Global layout wrapper: `src/components/Layout.tsx`
  - Global navigation: `src/components/Navbar.tsx`
  - Error boundary: `src/components/common/ErrorBoundary.tsx`
  - Evidence: `src/App.tsx`, `src/components/Layout.tsx`, `src/components/Navbar.tsx`, `src/components/common/ErrorBoundary.tsx`

- Shared state & hooks (cross-page)
  - UI state: `src/store/uiStore.ts` + `src/hooks/useUI.ts`
  - User state: `src/store/userStore.ts` + `src/hooks/useUser.ts`
  - Projects state: `src/store/projectsStore.ts` + `src/hooks/useProjects.ts`
  - Evidence: `src/store/uiStore.ts`, `src/store/userStore.ts`, `src/store/projectsStore.ts`, `src/hooks/useUI.ts`, `src/hooks/useUser.ts`, `src/hooks/useProjects.ts`

- Data access base
  - HTTP wrapper: `src/services/http.ts`
  - Env config: `src/config/env.ts`
  - Evidence: `src/services/http.ts`, `src/config/env.ts`

- Accelerator domain API surface (already centralized)
  - `src/services/accelerator.ts`
  - Evidence: `src/services/accelerator.ts`

- Discovery/heat shared logic (used by multiple accelerator pages, also by research page)
  - `src/services/utils/heatScore.ts` (calcHeat/inferPhase)
  - Evidence: `src/services/utils/heatScore.ts`, `src/pages/accelerator/MemeBoardPage.tsx`, `src/pages/accelerator/HeatRankPage.tsx`

---

## B. 目标架构（重新设计）

Design goal: make the repo _explicitly_ 4-domain, with a strict App Shell and clear shared layers, without breaking existing UX.

### B1) App Shell 职责清单（只管路由/鉴权/布局/主题/埋点/错误边界）

Proposed App Shell responsibilities (and nothing else):

1. Routing
   - Central routing entry, domain route registration, lazy loading
   - Evidence (current centralized routing): `src/App.tsx`
2. Auth & Access control
   - Route guards (anon/user/admin), session bootstrap
   - Evidence (admin route currently unguarded): `src/App.tsx` (`/accelerator/admin`)
   - Evidence (user model exists): `src/store/userStore.ts`
3. Global layout
   - Navbar, outer layout frame
   - Evidence: `src/components/Layout.tsx`, `src/components/Navbar.tsx`
4. Theme
   - Light/dark, persist, apply to document root
   - Evidence: `src/store/uiStore.ts`
5. Telemetry
   - pageview + CTA tracking
   - Evidence (need exists because multi-entry can bypass): `src/meme-board-main.tsx`
6. Error boundaries
   - App-level + optional domain-level
   - Evidence: `src/components/common/ErrorBoundary.tsx`

Hard requirement derived from current code: multi-entry must not bypass the shell.

- Evidence: `src/meme-board-main.tsx` renders `MemeBoardPage` directly.

### B2) 四个 Domain 的边界与职责（含目录结构建议）

Proposed top-level structure:

- `src/app/*` (App Shell)
  - router, layout, guards, telemetry, error boundary wiring
  - Evidence for current responsibilities living elsewhere: `src/App.tsx`, `src/components/Layout.tsx`

- `src/domains/arena/*`
  - Scope: competitions, seasons, signup, leaderboard, rules
  - Evidence: `src/pages/ArenaPage.tsx` (tabs: active/upcoming/history/my-stats; signup CTA; rules module)
  - Suggested structure:
    - `src/domains/arena/pages/ArenaPage.tsx`
    - `src/domains/arena/model/{Competition,Season,Leaderboard}.ts`
    - `src/domains/arena/api/arenaApi.ts`

- `src/domains/insurance/*`
  - Scope: insurance products, quotes, policies, claims
  - Evidence: `src/pages/InsurancePage.tsx` (buy flow steps + my-policies + claims)
  - Suggested structure:
    - `src/domains/insurance/pages/InsurancePage.tsx`
    - `src/domains/insurance/model/{Product,Policy,Claim}.ts`
    - `src/domains/insurance/api/insuranceApi.ts`

- `src/domains/stocks/*` (选股区)
  - Scope: strategies, asset selection, leverage mode, simulator, project research
  - Evidence: `src/pages/StrategiesPage.tsx` (ASSETS/LEVERAGES + "资金盘" + NFT share simulator)
  - Evidence: `src/pages/project/ProjectPage.tsx` + `src/components/features/ProjectPage/IndexBasketPanel.tsx` (project index/basket)
  - Suggested structure:
    - `src/domains/stocks/pages/StrategiesPage.tsx`
    - `src/domains/stocks/pages/StrategySimulatorPage.tsx`
    - `src/domains/stocks/pages/ProjectResearchPage.tsx` (from `/p/:id`)
    - `src/domains/stocks/widgets/*` (research page component group)

- `src/domains/accelerator/*` (1USD 加速器)
  - Scope: projects, submission, shorts, lottery, markets, transparency, heat, tickets, admin
  - Evidence: routes in `src/App.tsx`, pages in `src/pages/accelerator/*`
  - Suggested structure:
    - `src/domains/accelerator/pages/*`
    - `src/domains/accelerator/model/*`
    - `src/domains/accelerator/api/*` (seeded by `src/services/accelerator.ts`)

### B3) 共享层：`packages/ui` 与 `packages/core` 应该包含什么

Observation: shared logic is currently scattered across `src/components/*`, `src/services/*`, `src/store/*`.

- Evidence: `src/services/http.ts`, `src/services/accelerator.ts`, `src/store/*`, `src/components/*`

Target split:

- `packages/core` (cross-domain technical primitives, no page UI)
  - http client, typed errors, auth header injection
    - Evidence: current http wrapper is `src/services/http.ts`
  - env/config access
    - Evidence: `src/config/env.ts`
  - event bus (typed) + caching conventions
    - Evidence (need exists due to multi-route data refresh): `src/store/projectsStore.ts`
  - shared utilities (formatting, time)
    - Evidence: `src/services/utils/*`

- `packages/ui` (visual primitives only)
  - Button/Input/Modal/Skeleton/EmptyState, tokens/theme
    - Evidence (existing common components): `src/components/common/*`
  - App shell components can be _temporarily_ kept in app layer, then down-leveled
    - Evidence: `src/components/Layout.tsx`, `src/components/Navbar.tsx`

### B4) 跨域通信：API vs 事件（列事件名与触发点）

Rule:

- Cross-domain **state invalidation & UX sync** -> events
- Cross-domain **business reads/writes** -> API (later via BFF)

Proposed events (typed, stable names):

- `auth/logged_in`
  - Trigger: user login success
  - Evidence: user actions exist in `src/hooks/useUser.ts` and `src/store/userStore.ts`
- `auth/logged_out`
  - Trigger: logout
  - Evidence: `src/hooks/useUser.ts`, `src/store/userStore.ts`
- `wallet/connected`
  - Trigger: connectWallet
  - Evidence: `src/store/userStore.ts`
- `wallet/disconnected`
  - Trigger: disconnectWallet
  - Evidence: `src/store/userStore.ts`
- `accelerator/ticket_purchased`
  - Trigger: ticket purchase API success
  - Evidence (API exists): `src/services/accelerator.ts` (`purchaseTicket`)
  - Evidence (UI entry): `src/pages/accelerator/LotteryPage.tsx`, `src/pages/accelerator/MyTicketsPage.tsx`
- `data/invalidate`
  - Payload example: `{ domain: 'accelerator', resource: 'projects', id?: string }`
  - Trigger: any mutation endpoint returns success
  - Evidence (store has list+detail): `src/store/projectsStore.ts` (fetchProjects/fetchProjectById)

What should go through API (not events):

- `arena` season/leaderboard authoritative state
  - Evidence (competition UI expects it): `src/pages/ArenaPage.tsx`
- `insurance` quotes/policies/claims
  - Evidence: `src/pages/InsurancePage.tsx`
- `stocks` simulations and research evidence feeds
  - Evidence: `src/pages/StrategySimulatorPage.tsx`, `src/pages/project/ProjectPage.tsx`
- `accelerator` markets/lottery/transparency
  - Evidence: `src/pages/accelerator/MarketsPage.tsx`, `src/pages/accelerator/LotteryPage.tsx`, `src/pages/accelerator/TransparencyPage.tsx`

### B5) 数据层规范：缓存策略、错误码、接口命名约定

Current baseline:

- Base URL is env-driven
  - Evidence: `src/config/env.ts`
- http wrapper throws `Error(message)` without typed error code
  - Evidence: `src/services/http.ts` (handleResponse)
- Accelerator API paths already have a domain prefix (`/accelerator/*`)
  - Evidence: `src/services/accelerator.ts`

Proposed conventions:

- URL & naming
  - Prefix: `/api/v1/{domain}/...` (or keep `/api/{domain}` but enforce domain prefix)
  - Resource names plural: `projects`, `tickets`, `policies`
  - Evidence (current prefix pattern exists): `src/services/accelerator.ts`

- Auth
  - Header: `Authorization: Bearer <token>`
  - Public endpoints must be explicit
  - Evidence (user session exists): `src/store/userStore.ts`

- Pagination
  - Prefer cursor: `{ cursor, limit }` for scalable lists
  - Compatibility layer for page/limit because state already uses it
  - Evidence: `src/store/projectsStore.ts` has `page` + `limit`

- Caching
  - List endpoints: SWR semantics, default TTL 30s
  - Detail endpoints: TTL 5m; mutate -> emit `data/invalidate`
  - Evidence (need for invalidation): `src/services/accelerator.ts` has create/update/delete

- Error format
  - Standard response shape:
    - `200`: `{ data, meta? }`
    - `4xx/5xx`: `{ error: { code, message, details?, request_id? } }`
  - Frontend mapping by code (toast/retry/logout)
  - Evidence (current lacks code): `src/services/http.ts`

---

## C. API 合同草案（按域分组）

> Goal: MVP contracts enabling UI flows. Accelerator endpoints align with existing `src/services/accelerator.ts`; other domains are derived from page requirements.

### C0) 全局约定（鉴权 + 分页）

- Base URL: `${VITE_API_BASE_URL}` (defaults to `http://localhost:3000/api`)
  - Evidence: `src/config/env.ts`
- Auth: `Authorization: Bearer <token>`
  - Evidence (user state exists): `src/store/userStore.ts`
- Pagination:
  - Cursor: `cursor` + `limit` (preferred)
  - Page: `page` + `limit` (supported)
  - Evidence: `src/store/projectsStore.ts`

### C1) accelerator（1USD加速器）

Evidence for existing surface: `src/services/accelerator.ts`.

1. List projects

- `GET /accelerator/projects`
- request (query): `{ status?, category?, sortBy?, sortOrder?, page?, limit? }`
- response: `MemeToken[]`
- errors: `UNAUTHORIZED`, `VALIDATION_FAILED`
- Evidence: `src/services/accelerator.ts` (`getProjects(filters)`)

2. Get project detail

- `GET /accelerator/projects/{id}`
- response: `ProjectDetail`
- errors: `NOT_FOUND`, `UNAUTHORIZED`
- Evidence: `src/services/accelerator.ts` (`getProjectById`)

3. Create project

- `POST /accelerator/projects`
- request body: `ProjectCreateData`
- response: `MemeToken`
- errors: `VALIDATION_FAILED`, `UNAUTHORIZED`, `FORBIDDEN`
- Evidence: `src/services/accelerator.ts` (`createProject`)
- UI evidence: `src/pages/accelerator/SubmitProjectPage.tsx`

4. Update project

- `PATCH /accelerator/projects/{id}`
- request body: `Partial<ProjectCreateData>`
- response: `MemeToken`
- errors: `NOT_FOUND`, `UNAUTHORIZED`, `FORBIDDEN`
- Evidence: `src/services/accelerator.ts` (`updateProject`)

5. Delete project

- `DELETE /accelerator/projects/{id}`
- response: `204 No Content`
- errors: `NOT_FOUND`, `UNAUTHORIZED`, `FORBIDDEN`
- Evidence: `src/services/accelerator.ts` (`deleteProject`)

6. Purchase ticket

- `POST /accelerator/tickets`
- request body: `{ projectId, amountUsd }`
- response: `{ ticketId, txHash }`
- errors: `UNAUTHORIZED`, `INSUFFICIENT_FUNDS`, `VALIDATION_FAILED`
- Evidence: `src/services/accelerator.ts` (`purchaseTicket`)
- UI evidence: `src/pages/accelerator/LotteryPage.tsx`

7. List my tickets

- `GET /accelerator/tickets/me`
- response: `Array<{ id, projectId, projectName, projectTicker, amountUsd, purchasedAt, status }>`
- errors: `UNAUTHORIZED`
- Evidence: `src/services/accelerator.ts` (`getMyTickets`)
- UI evidence: `src/pages/accelerator/MyTicketsPage.tsx`

8. Lottery info

- `GET /accelerator/lottery`
- response: `{ currentPool, nextDrawAt, recentWinners[] }`
- errors: `SERVICE_UNAVAILABLE`
- Evidence: `src/services/accelerator.ts` (`getLotteryInfo`)

9. Markets

- `GET /accelerator/markets`
- response: `Array<{ id, name, ticker, price, change24h, marketCap }>`
- errors: `SERVICE_UNAVAILABLE`
- Evidence: `src/services/accelerator.ts` (`getMarkets`)

10. Transparency report

- `GET /accelerator/transparency`
- response: `{ totalRaised, totalParticipants, totalProjects, distribution[] }`
- errors: `SERVICE_UNAVAILABLE`
- Evidence: `src/services/accelerator.ts` (`getTransparencyReport`)
- UI evidence: `src/pages/accelerator/TransparencyPage.tsx`

### C2) arena（比赛区）

Evidence for required flows: `src/pages/ArenaPage.tsx`.

1. List competitions

- `GET /arena/competitions`
- query: `{ status?: 'active'|'upcoming'|'ended', cursor?, limit?, page?, limit? }`
- response: `{ data: Competition[], pageInfo }`
- errors: `SERVICE_UNAVAILABLE`

2. Competition detail

- `GET /arena/competitions/{id}`
- response: `{ data: CompetitionDetail }`
- errors: `NOT_FOUND`

3. Signup

- `POST /arena/competitions/{id}/signup`
- body: `{ accountId, exchange?: string, apiKeyRef?: string }`
- response: `{ data: { signupId, status } }`
- errors: `UNAUTHORIZED`, `DEADLINE_PASSED`, `VALIDATION_FAILED`

4. Leaderboard

- `GET /arena/competitions/{id}/leaderboard`
- query: `{ cursor?, limit?, page?, limit? }`
- response: `{ data: LeaderboardEntry[], pageInfo }`
- errors: `NOT_FOUND`

5. My stats

- `GET /arena/me/stats`
- response: `{ data: { competitionsParticipated, bestRank, pnl, winRate } }`
- errors: `UNAUTHORIZED`

Evidence for above needs:

- Tabs & CTA exist: `src/pages/ArenaPage.tsx`

### C3) insurance（保险区）

Evidence for required flows: `src/pages/InsurancePage.tsx`.

1. List insurance products

- `GET /insurance/products`
- response: `{ data: InsuranceProduct[] }`
- errors: `SERVICE_UNAVAILABLE`

2. Quote

- `POST /insurance/quotes`
- body: `{ asset, leverage, positionSide, notionalUsd, duration }`
- response: `{ data: { quoteId, premiumUsd, coverageUsd, termsUrl } }`
- errors: `VALIDATION_FAILED`, `RISK_TOO_HIGH`

3. Purchase policy

- `POST /insurance/policies`
- body: `{ quoteId, paymentMethod }`
- response: `{ data: { policyId, status } }`
- errors: `UNAUTHORIZED`, `PAYMENT_FAILED`

4. List my policies

- `GET /insurance/policies/me`
- response: `{ data: Policy[] }`
- errors: `UNAUTHORIZED`

5. Policy detail

- `GET /insurance/policies/{id}`
- response: `{ data: PolicyDetail }`
- errors: `NOT_FOUND`, `UNAUTHORIZED`

6. Create claim

- `POST /insurance/claims`
- body: `{ policyId, liquidationTxHash?, evidenceUrl? }`
- response: `{ data: { claimId, status } }`
- errors: `UNAUTHORIZED`, `POLICY_NOT_ACTIVE`, `VALIDATION_FAILED`

7. List my claims

- `GET /insurance/claims/me`
- response: `{ data: Claim[] }`
- errors: `UNAUTHORIZED`

Evidence for above needs:

- Buy flow steps + my-policies + claims tab: `src/pages/InsurancePage.tsx`

### C4) stocks（选股区）

Evidence: `src/pages/StrategiesPage.tsx`, `src/pages/StrategySimulatorPage.tsx`, `/p/:id` -> `src/pages/project/ProjectPage.tsx`.

1. Assets

- `GET /stocks/assets`
- response: `{ data: Array<{ symbol, label, maxLeverage }> }`
- errors: `SERVICE_UNAVAILABLE`

2. Strategy list

- `GET /stocks/strategies`
- query: `{ asset?, leverage?, cursor?, limit? }`
- response: `{ data: Strategy[], pageInfo }`
- errors: `SERVICE_UNAVAILABLE`

3. Simulate strategy

- `POST /stocks/strategies/simulate`
- body: `{ principalUsd, leverage, returnRate, feeModel? }`
- response: `{ data: { user, platform, nftHolder, total } }`
- errors: `VALIDATION_FAILED`

4. Research page aggregate

- `GET /stocks/projects/{id}/research`
- response: `{ data: { radar, evidenceSummary, indexBasket } }`
- errors: `NOT_FOUND`

5. Evidence feed

- `GET /stocks/projects/{id}/evidence`
- query: `{ cursor?, limit? }`
- response: `{ data: EvidenceItem[], pageInfo }`
- errors: `NOT_FOUND`

6. Index basket

- `GET /stocks/projects/{id}/index-basket`
- response: `{ data: { constituents: Array<{ symbol, weight }>, rebalanceAt, rationale } }`
- errors: `NOT_FOUND`

Evidence for above needs:

- Asset selection constants: `src/pages/StrategiesPage.tsx` (ASSETS/LEVERAGES)
- Simulator logic: `src/pages/StrategySimulatorPage.tsx`
- Research/index basket widgets: `src/pages/project/ProjectPage.tsx`, `src/components/features/ProjectPage/IndexBasketPanel.tsx`

---

## D. 迁移计划（最小改动）

### Day1：不改业务，仅整理目录与壳/域边界

Goal: keep behavior unchanged; only reorganize code and make boundaries explicit.

- Freeze route paths (no URL changes)
  - Evidence (current route table): `src/App.tsx`, `docs/04-路由配置.md`
- Create `src/app/*` and move shell responsibilities there
  - Source evidence for shell: `src/App.tsx`, `src/components/Layout.tsx`, `src/components/common/ErrorBoundary.tsx`
- Create `src/domains/{arena,insurance,stocks,accelerator}` and move page files
  - Evidence for current page locations: `src/pages/*`, `src/pages/accelerator/*`, `src/pages/project/ProjectPage.tsx`
- Unify multi-entry: meme-board entry must enter the same shell (or a thin shell)
  - Evidence (bypass exists): `src/meme-board-main.tsx`

Deliverable checks:

- Every route in `src/App.tsx` points to a file under a domain folder (except shell landing `/`).

### Day3：抽 core/ui + 改路由为注册式

Goal: reduce coupling; prepare for BFF.

- Extract `core`
  - Move/port `src/services/http.ts` and `src/config/env.ts` into `packages/core`
  - Evidence: `src/services/http.ts`, `src/config/env.ts`
- Extract `ui`
  - Move/port reusable UI primitives from `src/components/common/*`
  - Evidence: `src/components/common/ErrorBoundary.tsx` (example), `src/components/common/Skeleton.tsx` (example)
- Router becomes registration-based
  - Each domain exports its `routes[]`
  - Shell composes them
  - Evidence (current hard-coded routes): `src/App.tsx`

### Week1：引入 BFF + 埋点 + 权限统一

Goal: production-grade operations.

- BFF
  - Add a backend-for-frontend that normalizes errors/auth/pagination and aggregates calls
  - Accelerator is the best first target because it already has centralized API surface
  - Evidence: `src/services/accelerator.ts`

- Telemetry
  - Add pageview + CTA tracking in App Shell
  - Special focus: flows currently implemented as UI-only mock need observability
  - Evidence (mock heavy pages): `src/pages/accelerator/LotteryPage.tsx`, `src/pages/accelerator/MarketsPage.tsx`, `src/pages/accelerator/ProjectsPage.tsx`

- Permission model
  - Guard admin routes
  - Evidence (admin route exists): `src/App.tsx` (`/accelerator/admin`)
  - Evidence (user state exists): `src/store/userStore.ts`

---

## 附：证据索引（高频路径）

- Routing: `src/App.tsx`, `docs/04-路由配置.md`
- Multi-entry: `vite.config.ts`, `index.html`, `meme-board.html`, `src/main.tsx`, `src/meme-board-main.tsx`
- Shared infra: `src/services/http.ts`, `src/config/env.ts`
- Accelerator API: `src/services/accelerator.ts`
- Domain pages: `src/pages/ArenaPage.tsx`, `src/pages/InsurancePage.tsx`, `src/pages/StrategiesPage.tsx`, `src/pages/StrategySimulatorPage.tsx`, `src/pages/accelerator/*`, `src/pages/project/ProjectPage.tsx`
